#!/usr/bin/env bash

if [ "$EUID" -ne 0 ]
  then echo "Please run as root"
  exit
fi

rmmod pcan || true
modprobe pcan

# See: https://github.com/mjbots/moteus/blob/main/docs/reference.md#80-mhz-clock-systems
# The default CAN FD sjw and sample-point values are suboptimal
ip link set can0 up type can bitrate 1000000 dbitrate 5000000 berr-reporting on fd on sjw 10 dsjw 5 sample-point 0.666 dsample-point 0.666
ip link set can1 up type can bitrate 1000000 dbitrate 5000000 berr-reporting on fd on sjw 10 dsjw 5 sample-point 0.666 dsample-point 0.666
ip link set can2 up type can bitrate 1000000 dbitrate 5000000 berr-reporting on fd on sjw 10 dsjw 5 sample-point 0.666 dsample-point 0.666
ip link set can3 up type can bitrate 1000000 dbitrate 5000000 berr-reporting on fd on sjw 10 dsjw 5 sample-point 0.666 dsample-point 0.666

ip link set can0 txqueuelen 512
ip link set can1 txqueuelen 512
ip link set can2 txqueuelen 512
ip link set can3 txqueuelen 512

